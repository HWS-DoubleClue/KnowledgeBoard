<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://java.sun.com/jsf/html" xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core" xmlns:p="http://primefaces.org/ui" xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:fn="http://java.sun.com/jsp/jstl/functions">

	<style>
img {
	max-width: 100%;
}
</style>
	<f:view locale="#{operatorSession.locale}">
		<div style="width: 90%; margin: auto">
			<h:form id="replyForm">
				<p:commandButton value="#{KbMsg['kbDashboardView']}" action="#{kbReplyQuestionView.closeQuestion()}" style="margin-bottom:1em; width: auto"
					icon="fa fa-solid fa-circle-chevron-left" />
				<p:panel id="questionPanel" toggleable="true" style="word-wrap: break-word">
					<f:facet name="actions">
						<p:commandLink icon="pi pi-pencil" styleClass="ui-panel-titlebar-icon " style="margin-bottom: 10px" action="#{kbReplyQuestionView.editQuestion()}"
							rendered="#{kbReplyQuestionView.hasQuestionEditPermission()}">
							<h:outputText styleClass="ui-icon pi pi-pencil" style="border:1px solid #c8c8c8;" />
							<p:ajax event="dialogReturn" update="replyForm" listener="#{kbReplyQuestionView.reload()}" />
						</p:commandLink>
					</f:facet>
					<f:facet name="header">
								#{kbReplyQuestionView.kbQuestionEntity.title}
								<h:outputText value="(ID: #{kbReplyQuestionView.kbQuestionEntity.id} " style="font-size: 0.6em" />
						<p:spacer width="3" />
						<i class="far fa-folder-open" style="font-size: 0.7em" />
						<p:spacer width="3" />
						<h:outputText id="categorylabel" value=" #{kbReplyQuestionView.kbQuestionEntity.category.name})" style="font-size: 0.6em" />
						<p:tooltip style="font-size: 0.6em" for="categorylabel" value="#{kbReplyQuestionView.kbQuestionEntity.category.description}" position="right" />
					</f:facet>
					<div class="ui-g">
						<div style="word-wrap: break-word;" class="ui-g-9">
							<div class="ui-g-12">
								<h:outputText value="#{kbReplyQuestionView.kbQuestionEntity.questionContent.content}" escape="false" />
							</div>
							<div class="ui-g-12 tag-box">
								<p:outputPanel rendered="#{not empty kbReplyQuestionView.kbQuestionEntity.tags}" style="font-size:0.85em">
									<i class="fas fa-tags" />
									<h:outputText value=" #{KbMsg['KbQuestion.tags']}: " />
									<ui:repeat value="#{kbReplyQuestionView.kbQuestionEntity.tags}" var="tag">
										<h:outputText id="tagbox" value="#{tag.name}" class="q-tag" />
										<p:tooltip for="tagbox" value="#{tag.description}" position="right" />
									</ui:repeat>
								</p:outputPanel>
							</div>
						</div>
						<div class="ui-g-3" style="border-left: 2px solid lightgray; font-size: 0.8em">
							<div class="ui-g-12">
								<h:outputText
									value="#{KbMsg['KbQuestion.author']}: #{kbReplyQuestionView.kbQuestionEntity.author == null ? KbMsg['dashboard.view.deletedAuthor'] : kbReplyQuestionView.kbQuestionEntity.author.displayName}" />
								<p:spacer width="20" />
								<p:avatar style=" vertical-align: middle;" styleClass="p-mr-2" size="xlarge" shape="circle">
									<p:graphicImage value="#{kbReplyQuestionView.getUserPhoto(kbReplyQuestionView.kbQuestionEntity.author)}" stream="false" />
								</p:avatar>
							</div>
							<div class="ui-g-12">
								<h:outputText value="#{KbMsg['KbQuestion.status']}: #{kbReplyQuestionView.kbQuestionEntity.status.name()}" />
							</div>
							<div class="ui-g-12">
								<h:outputText value="#{KbMsg['KbQuestion.creationDate']}: " />
								<h:outputText value="#{kbReplyQuestionView.kbQuestionEntity.creationDate}" converter="dcem.LocalDateTimeConverter" />
							</div>
							<div class="ui-g-12">
								<h:outputText value="#{KbMsg['KbQuestion.lastModifiedOn']}: " />
								<h:outputText value="#{kbReplyQuestionView.kbQuestionEntity.lastModifiedOn}" converter="dcem.LocalDateTimeConverter" />
							</div>
						</div>
					</div>
				</p:panel>
				<p:spacer height="30" />
				<div style="font-size: 1.7em; color: #005078">
					<h:outputText
						value="#{kbReplyQuestionView.kbQuestionEntity.replies.size()} #{kbReplyQuestionView.kbQuestionEntity.replies.size()==1 ? KbMsg['reply.view.reply'] : KbMsg['reply.view.replies']} " />
				</div>
				<p:spacer height="25" />
				<p:dataView id="replies" var="reply" value="#{kbReplyQuestionView.kbQuestionEntity.replies}" layout="list" emptyMessage="">
					<p:dataViewListItem>
						<p:panel toggleable="true"
							header="#{kbReplyQuestionView.kbQuestionEntity.replies.indexOf(reply)+1}# #{KbMsg['reply.view.replyFrom']} '#{reply.author == null ? KbMsg['dashboard.view.deletedAuthor'] : reply.author.displayName}'">
							<f:facet name="actions">
								
								<p:commandLink icon="pi pi-trash" styleClass="ui-panel-titlebar-icon " style="margin-bottom: 10px" action="#{kbReplyQuestionView.deleteReply(reply)}"
									rendered="#{kbReplyQuestionView.hasReplyDeletePermission(reply)}">
									<h:outputText styleClass="ui-icon pi pi-trash" style="border:1px solid #c8c8c8;" />
									<p:ajax event="dialogReturn" update="replies" listener="#{kbReplyQuestionView.reload()}" />
								</p:commandLink>
								
								<p:commandLink icon="pi pi-pencil" styleClass="ui-panel-titlebar-icon " style="margin-bottom: 10px" action="#{kbReplyQuestionView.editReply(reply)}"
									rendered="#{kbReplyQuestionView.hasReplyEditPermission(reply)}">
									<h:outputText styleClass="ui-icon pi pi-pencil" style="border:1px solid #c8c8c8;" />
									<p:ajax event="dialogReturn" update="replies" />
								</p:commandLink>

							</f:facet>
							<div class="ui-g">
								<div class="ui-g-9">
									<div class="ui-g-12" style="word-wrap: break-word">
										<h:outputText value="#{reply.replyContent.content}" escape="false" />
									</div>
								</div>
								<div class="ui-g-3" style="border-left: 2px solid lightgray; font-size: 0.8em">

									<div class="ui-g-12">
										<h:outputText
											value="#{KbMsg['dashboard.view.questionAuthor']} #{reply.author == null ? KbMsg['dashboard.view.deletedAuthor'] : reply.author.displayName}" />
										<p:spacer width="20" />
										<p:avatar style=" vertical-align: middle;" styleClass="p-mr-2" size="xlarge" shape="circle">
											<p:graphicImage value="#{kbReplyQuestionView.getUserPhoto(reply.author)}" stream="false" />
										</p:avatar>
									</div>
									<div class="ui-g-12">
										<h:outputText value="#{KbMsg['KbReply.creationDate']}: " />
										<h:outputText value="#{reply.creationDate}" converter="dcem.LocalDateTimeConverter" />
									</div>
									<div class="ui-g-12">
										<h:outputText value="#{KbMsg['KbReply.lastModifiedOn']}: " />
										<h:outputText value="#{reply.lastModifiedOn}" converter="dcem.LocalDateTimeConverter" />
									</div>

								</div>
							</div>

						</p:panel>
					</p:dataViewListItem>
				</p:dataView>
				<h:panelGroup rendered="#{kbReplyQuestionView.kbQuestionEntity.status != kbReplyQuestionView.closedStatus}">
					<p:spacer height="30" />
					<div style="font-size: 2em; color: #005078">
						<h:outputText value="#{KbMsg['reply.view.addReply']}" />
					</div>
					<p:spacer height="25" />
					<p:textEditor value="#{kbReplyQuestionView.replyText}" style="height:15em; margin-bottom:5em"></p:textEditor>
					<p:commandButton value="#{KbMsg['reply.view.toReply']}" action="#{kbReplyQuestionView.actionCreateReply()}" style="margin-bottom:1em; width: auto"
						update="replyForm" icon="fas fa-reply" />
				</h:panelGroup>
				<p:spacer height="25" />
			</h:form>
		</div>

	</f:view>
</ui:composition>